<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Producto</title>
    <script src="https://unpkg.com/vue@next"></script>
</head>
<body>
    <div id="app">
        <h1>Editar Producto</h1>
        <form @submit.prevent="editarProducto" enctype="multipart/form-data">
            <div>
                <label for="plataforma">Plataforma:</label>
                <input type="text" id="plataforma" v-model="plataforma" required>
            </div>
            <div>
                <label for="descripcion">Descripción:</label>
                <input type="text" id="descripcion" v-model="descripcion" required>
            </div>
            <div>
                <label for="cantidad">Cantidad:</label>
                <input type="number" id="cantidad" v-model="cantidad" required>
            </div>
            <div>
                <label for="precio">Precio:</label>
                <input type="number" id="precio" v-model="precio" required>
            </div>
            <div>
                <label for="foto">Foto:</label>
                <input type="file" id="foto" @change="cargarFoto">
            </div>
            <button type="submit">Guardar</button>
        </form>
    </div>

    <script>
        const URL = "https://pieroja.pythonanywhere.com/";

        const app = Vue.createApp({
    data() {
        return {
            codigo: null,
            plataforma: '',
            descripcion: '',
            cantidad: 0,
            precio: 0,
            foto: null  // Agrega la propiedad 'foto' para almacenar el archivo seleccionado
        }
    },
    methods: {
        editarProducto() {
            const formData = new FormData();

            formData.append('plataforma', this.plataforma);
            formData.append('descripcion', this.descripcion);
            formData.append('cantidad', this.cantidad);
            formData.append('precio', this.precio);

            // Agregar la foto solo si se ha seleccionado un archivo
            if (this.foto) {
                formData.append('foto', this.foto);
            }

            // Realizar una solicitud PUT al servidor para guardar los cambios del producto
            fetch(URL + `productos/${this.codigo}`, {
                method: 'PUT',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    alert('Producto editado correctamente.');
                    // Redirigir de vuelta a la página de listado de productos
                    window.location.href = 'listadoFoto.html';
                } else {
                    throw new Error('Error al editar el producto.');
                }
            })
            .catch(error => {
                console.log('Error:', error);
                alert('Error al editar el producto.');
            });
        },
        obtenerProducto() {
            // Obtener el código del producto
            const urlParams = new URLSearchParams(window.location.search);
            this.codigo = urlParams.get('codigo');

            // Realizar una petición HTTP para obtener el producto por su código
            fetch(URL + `productos/${this.codigo}`)
            .then(response => response.json())
            .then(data => {
                // Asigna los datos del producto a las variables correspondientes
                this.plataforma = data.plataforma;
                this.descripcion = data.descripcion;
                this.cantidad = data.cantidad;
                this.precio = data.precio;
            })
            .catch(error => {
                console.error(error);
            });
        },
        cargarFoto(event) {
            const file = event.target.files[0];
            this.foto = file;
        }
    },
    mounted() {
        // Al cargar la página, obtenemos los datos del producto
        this.obtenerProducto();
    }
});

app.mount('#app');
    </script>    
</body>
</html>